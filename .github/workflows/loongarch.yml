name: LoongArch
'on':
  workflow_dispatch: null
jobs:
  build-loongarch64:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Build .NET application for LoongArch64
        run: |
          docker run --rm --platform linux/loong64 \
            -v ${{ github.workspace }}:/workspace \
            -w /workspace \
            loong64/debian:latest \
            bash -c "
              apt-get update && \
              apt-get install -y wget && \
              wget https://dot.net/v1/dotnet-install.sh && \
              bash dotnet-install.sh --channel 8.0 --install-dir /usr/share/dotnet && \
              export PATH=\$PATH:/usr/share/dotnet && \
              dotnet publish -c Release -r linux-loongarch64 --self-contained true
            "
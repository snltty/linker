name: LoongArch
'on':
  workflow_dispatch: null
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      - name: Build with Loongson .NET SDK
        run: |
          # 使用龙芯官方提供的 .NET SDK 镜像
          docker run --rm --platform linux/loong64 \
            -v ${{ github.workspace }}:/src \
            -w /src \
            loongnix/dotnet:8.0-sdk \
            /bin/bash -c "
              # 恢复依赖
              dotnet restore && \
              
              # 发布应用
              dotnet publish ./src/linker -c Release \
                -r linux-loongarch64 \
                --self-contained true \
                -p:PublishSingleFile=true \
                -p:IncludeNativeLibrariesForSelfExtract=true \
                -o /src/publish
            "